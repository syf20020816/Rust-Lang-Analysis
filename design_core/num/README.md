# Num Design

## ğŸ‘shells

åœ¨è¿™ä¸ªç›®å½•ä¸‹å®ç°äº†i/uä¸¤ç§ç³»åˆ—çš„æ•°å­—ç±»å‹ä»¥åŠä¸€ä¸ªint_macrosä¸­çš„`int_module!`è€Œè¿™é‡Œåšçš„äº‹æƒ…å¾ˆç®€å•å°±æ˜¯ç”Ÿæˆå¯¹åº”æ•°å­—ç±»å‹çš„ MAXå’ŒMINï¼Œä»¥å¦‚ä¸‹å½¢å¼:

```rust
pub const MIN:i8 = i8::MIN
pub const MAX:i8 = i8::MAX
```

### int_module!

ç›®çš„æ˜¯ç»Ÿä¸€çš„ï¼Œç®€ä¾¿çš„ç”Ÿæˆå¯¹åº”æ¯ä¸ªi/uæ•°å­—ç±»å‹çš„æœ€å¤§æœ€å°å€¼å¼•ç”¨

è¿™äº›å¸¸é‡æ¨¡å—æä¾›äº†ä¸åŸºæœ¬ç±»å‹ç›¸å…³çš„æœ‰ç”¨å¸¸é‡ï¼Œè®¾è®¡è¿™äº›å†—ä½™çš„å¸¸é‡æ¨¡å—æœ‰å‡ ä¸ªä¸»è¦åŸå› ï¼š

1. **æ–¹ä¾¿å¯¼å…¥**: ä½¿ç”¨ `std::i8::MIN` å’Œ `std::i8::MAX` è¿™æ ·çš„å…¨åè·¯å¾„å¯ä»¥æ˜ç¡®æŒ‡å®šè¦ä½¿ç”¨çš„å¸¸é‡ã€‚è¿™åœ¨ä»£ç ä¸­å¯ä»¥æä¾›æ›´æ¸…æ™°çš„è¯­ä¹‰ï¼Œå¹¶ä¸”èƒ½å¤Ÿé¿å…å‘½åå†²çªã€‚
2. **è·¨æ¨¡å—å¯è§æ€§**: é€šè¿‡å°†å¸¸é‡æ”¾åœ¨å¸¸é‡æ¨¡å—ä¸­ï¼Œå¯ä»¥åœ¨ä¸åŒçš„æ¨¡å—ä¸­è¿›è¡Œè®¿é—®ï¼Œè€Œæ— éœ€æ˜¾å¼åœ°å¼•å…¥å¸¸é‡ã€‚è¿™å¯¹äºåº“ä½œè€…å’Œç”¨æˆ·æ¥è¯´éƒ½å¾ˆæ–¹ä¾¿ï¼Œå› ä¸ºä»–ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™äº›å¸¸é‡ï¼Œè€Œæ— éœ€æ˜¾å¼å¯¼å…¥å®ƒä»¬ã€‚
3. **ç¤ºä¾‹å’Œå­¦ä¹ **: è¿™äº›å¸¸é‡æ¨¡å—æä¾›äº†ä¸€ä¸ªæ–¹ä¾¿çš„ä½ç½®ï¼Œå¯ä»¥æŸ¥çœ‹å’Œå­¦ä¹ ä¸ç‰¹å®šç±»å‹ç›¸å…³çš„å¸¸é‡å’Œçº¦æŸã€‚è¿™å¯¹äºåˆå­¦è€…æ¥è¯´å°¤å…¶æœ‰å¸®åŠ©ï¼Œå› ä¸ºå®ƒä»¬å¯ä»¥åœ¨æ ‡å‡†åº“æ–‡æ¡£ä¸­æ‰¾åˆ°ä¸æ•´æ•°ç±»å‹ç›¸å…³çš„å¸¸é‡ã€‚

## ğŸ‘int_impl

### constants

```rust
MyImplI8::MAX
MyImplI8::MIN
MyImplI8::BITS
```

### from_str_radix()

å°†ç»™å®šåŸºæ•°ä¸­çš„å­—ç¬¦ä¸²åˆ‡ç‰‡è½¬æ¢ä¸ºæ•´æ•°
æ„æ€å°±æ˜¯:
- u8::from_str_radix("16",10) == 16 :è¡¨ç¤ºå°†16è¿™ä¸ª10è¿›åˆ¶æ•°å­—è½¬ä¸ºæ•´æ•°
- u8::from_str_radix("16",8) == 14 :è¡¨ç¤ºå°†16è¿™ä¸ª8è¿›åˆ¶æ•°å­—è½¬ä¸ºæ•´æ•°

åœ¨int_implä¸­ä½¿ç”¨ï¼š`tests_rust_lang/lang_core/src/my_core/num/mod.rs`ä¸­çš„`from_str_radix()`

å¤„ç†æ­¥éª¤ï¼š

1. åˆ¤æ–­è¿›åˆ¶æ•°ï¼ˆrange:[2,36]ï¼‰
2. æ£€æŸ¥Empty
3. æ£€æŸ¥ç±»å‹ï¼ˆtrueï¼ši type numberï¼Œfalseï¼šu type numberï¼‰
4. ç›®æ ‡å­—ç¬¦ä¸²è½¬å­—èŠ‚åˆ‡ç‰‡ï¼ˆ[u8]ï¼‰
5. åŒ¹é…å­—èŠ‚åˆ‡ç‰‡é¦–ä½æ£€æŸ¥æ­£è´Ÿå€¼
6. ä»u32è½¬é€‚é…ç±»å‹
7. ç¡®å®šè¯¥åŸºæ•°é•¿åº¦çš„æ–‡æœ¬å­—ç¬¦ä¸²æ˜¯å¦å¯ä»¥ä¿è¯å­˜å‚¨åœ¨ç»™å®šçš„ç±»å‹Tä¸­(if can_not_overflow())
  - æ£€æŸ¥æº¢å‡º
8. ç»“æŸåŒ…è£…ä¸ºResult

#### ä½¿ç”¨

```rust
println!("{:?}", MyImplI8::from_str_radix("16", 8));
```

### count_ones()

ç”¨äºç»Ÿè®¡ä¸€ä¸ªæ•°è½¬ä¸º2è¿›åˆ¶æ•°åå…¶ä¸­1ä¸ªä¸ªæ•°ï¼Œä¾‹å¦‚ï¼š5 â†’ 0101 åˆ™ç»“æœä¸º2

### è¿™äº›æ–¹æ³•åœ¨å“ªï¼Ÿï¼ˆğŸ¦€ç¼–è¯‘å™¨å†…éƒ¨å‡½æ•°è¯´æ˜ï¼‰

è§ï¼š`technical_term.md`

åœ¨ Rust æºç ä¸­ï¼Œ`count_ones()` æ–¹æ³•çš„å®ç°ä½äº Unsigned æ•´æ•°ç±»å‹ï¼ˆå¦‚ `u8`ã€`u16`ã€`u32` ç­‰ï¼‰çš„å®šä¹‰ä¹‹ä¸­ã€‚è¿™ä¸ªæ–¹æ³•æ˜¯ç”±ç¼–è¯‘å™¨ä¸ºæ¯ä¸ª Unsigned æ•´æ•°ç±»å‹è‡ªåŠ¨ç”Ÿæˆçš„ã€‚

å…·ä½“æ¥è¯´ï¼Œæ•´æ•°ç±»å‹çš„ `count_ones()` æ–¹æ³•æ˜¯ä¸€ä¸ªå†…å»ºæ–¹æ³•ï¼ˆIntrinsicï¼‰ï¼Œç”±ç¼–è¯‘å™¨ç›´æ¥å®ç°å¹¶ä¼˜åŒ–ã€‚è¿™æ„å‘³ç€ç¼–è¯‘å™¨ä¼šæ ¹æ®å¹³å°å’Œç›®æ ‡æ¶æ„æä¾›é«˜æ•ˆçš„åº•å±‚å®ç°ã€‚ä½ åœ¨ä»£ç ä¸­ç›´æ¥è°ƒç”¨ `count_ones()` æ–¹æ³•ï¼Œå®é™…ä¸Šæ˜¯è°ƒç”¨äº†ç¼–è¯‘å™¨æä¾›çš„åº•å±‚å®ç°ã€‚

è¿™ä¹Ÿè§£é‡Šäº†ä¸ºä»€ä¹ˆå¯ä»¥ç›´æ¥è°ƒç”¨ `count_ones()` æ–¹æ³•ï¼Œå³ä½¿å…¶å®šä¹‰å¹¶ä¸åœ¨ä½ çš„ä»£ç ä¸­ã€‚Rust ç¼–è¯‘å™¨ä¼šæ ¹æ®ä¸Šä¸‹æ–‡å’Œç±»å‹æ¨å¯¼ï¼Œåœ¨ç¼–è¯‘æœŸé—´å°†è¿™ä¸ªè°ƒç”¨æ›¿æ¢ä¸ºç›¸åº”çš„åº•å±‚å®ç°ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ`count_ones()` ä½œä¸ºä¸€ä¸ªå†…å»ºæ–¹æ³•ï¼Œå®ƒçš„è¡Œä¸ºæ˜¯ä¸å¯¹åº”çš„å¹³å°å’Œåº•å±‚ç¡¬ä»¶ç›¸å…³çš„ã€‚å› æ­¤ï¼Œä¸åŒçš„è¿è¡Œç¯å¢ƒä¸‹ï¼Œ`count_ones()` å¯èƒ½ä¼šæœ‰ä¸åŒçš„å®ç°å’Œæ€§èƒ½ç‰¹å¾ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆç¼–è¯‘å™¨ä¼šä¸ºæ¯ä¸ª Unsigned æ•´æ•°ç±»å‹è‡ªåŠ¨ç”Ÿæˆ `count_ones()` æ–¹æ³•ï¼Œä»¥ä¾¿è¿›è¡Œåº•å±‚ä¼˜åŒ–å’Œé€‚é…ã€‚

## ğŸ‘midpoint()

ä½¿ç”¨branchless algorithmç®—æ³•ï¼ˆsee : technical_term.mdï¼‰

ğŸ‘calc : 5+6 = 11 -> 11/2 = 5...1 -> judge(..1)èˆå¼ƒä½™æ•° -> Result == 5

ğŸ‘move : ((5^6)>>1) + (5&6) -> Result == 5

 ``` rust
///é‡å†™å®ç°å¹¶éæºç 
pub struct MidPoint<T>{
    data:T
}

macro_rules! my_midpoint_impl {
    ($($NumT:ty)*) => ($(
        impl MidPoint<$NumT>{
            pub const fn new(data:$NumT)->Self{
                MidPoint{
                    data
                }
            }
            pub const fn calc_midpoint(self,rhs:$NumT)->$NumT{
                ((self.data ^ rhs) >> 1) + (self.data & rhs)
            }
        }
    )*);
}

my_midpoint_impl!{u8 u16 u32 u128}
 ```

## f32

f32 ç±»å‹æ˜¯ IEEE 754 æ ‡å‡†ä¸­å®šä¹‰çš„å•ç²¾åº¦æµ®ç‚¹æ•°ç±»å‹ï¼Œå®ƒç”¨äºè¡¨ç¤ºå¸¦æœ‰å•ç²¾åº¦ç²¾åº¦çš„æµ®ç‚¹æ•°å€¼ã€‚è¯¥ç±»å‹ä½¿ç”¨ 32 ä½ï¼ˆ4 å­—èŠ‚ï¼‰å†…å­˜æ¥å­˜å‚¨æµ®ç‚¹æ•°ã€‚

åœ¨ f32 ç±»å‹ä¸­ï¼ŒåŸºæ•°ï¼ˆå³åº•æ•°ï¼‰å¯¹æœ‰æ•ˆä½æ•°çš„å½±å“æ˜¯ç”±æµ®ç‚¹æ•°çš„è¡¨ç¤ºæ–¹æ³•å†³å®šçš„ã€‚æµ®ç‚¹æ•°ä½¿ç”¨ç§‘å­¦è®¡æ•°æ³•è¡¨ç¤ºï¼ŒåŒ…æ‹¬ä¸€ä¸ªå°¾æ•°å’Œä¸€ä¸ªæŒ‡æ•°ã€‚å°¾æ•°ä¸­çš„æœ‰æ•ˆä½æ•°ï¼ˆå³å°¾æ•°çš„ç²¾åº¦ï¼‰è¡¨ç¤ºæµ®ç‚¹æ•°å¯ä»¥å‡†ç¡®è¡¨ç¤ºçš„æ•°å­—çš„ä¸ªæ•°ã€‚

### ğŸ‘å†…åµŒå‡½æ•°ï¼ˆNested Functionï¼‰

è¿™é‡Œæˆ‘ä»¬è¦å­¦ä¹ çš„æ˜¯ä¸€ç§å†…åµŒå‡½æ•°çš„å†™æ³•

ä¼˜ç‚¹ï¼š

1. å°è£…æ€§å’Œç§æœ‰æ€§ï¼šå†…åµŒå‡½æ•°åªåœ¨å…¶çˆ¶å‡½æ•°å†…éƒ¨å¯è§ï¼Œè€Œå¯¹äºå¤–éƒ¨ä»£ç æ¥è¯´æ˜¯éšè—çš„ã€‚è¿™å¯ä»¥å¢å¼ºä»£ç çš„å°è£…æ€§å’Œæ¨¡å—åŒ–ï¼Œä½¿å¾—å†…éƒ¨é€»è¾‘å¯¹å¤–éƒ¨ä»£ç æ˜¯ä¸å¯è§çš„ï¼Œæé«˜äº†ä»£ç çš„å®‰å…¨æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚
2. ä»£ç å¤ç”¨ï¼šé€šè¿‡å°†åŠŸèƒ½ç›¸ä¼¼çš„ä»£ç åŒ…è£…åœ¨å†…éƒ¨å‡½æ•°ä¸­ï¼Œå¯ä»¥é¿å…ä»£ç é‡å¤ã€‚å†…åµŒå‡½æ•°å¯ä»¥è¢«çˆ¶å‡½æ•°å¤šæ¬¡è°ƒç”¨ï¼Œæä¾›äº†ä¸€ç§ä»£ç å¤ç”¨çš„æœºåˆ¶ã€‚
3. é€»è¾‘æ¸…æ™°æ€§ï¼šå†…åµŒå‡½æ•°å¯ä»¥å°†å¤æ‚çš„é€»è¾‘åˆ†è§£æˆæ›´å°çš„ã€æ›´æ˜“ç†è§£çš„éƒ¨åˆ†ã€‚é€šè¿‡å°†ä»£ç åˆ†å‰²æˆé€»è¾‘ç›¸å…³çš„å—ï¼Œå¯ä»¥æé«˜ä»£ç çš„å¯è¯»æ€§å’Œå¯ç†è§£æ€§ã€‚

ç¼ºç‚¹ï¼š

1. å¯è§èŒƒå›´é™åˆ¶ï¼šå†…åµŒå‡½æ•°åªèƒ½åœ¨å…¶çˆ¶å‡½æ•°å†…éƒ¨è°ƒç”¨ï¼Œæ— æ³•åœ¨å…¶å®ƒå‡½æ•°æˆ–æ¨¡å—ä¸­ä½¿ç”¨ã€‚å¦‚æœéœ€è¦åœ¨å…¶å®ƒåœ°æ–¹å¤ç”¨è¯¥åŠŸèƒ½ï¼Œå°±éœ€è¦å°†å†…åµŒå‡½æ•°æå–åˆ°ä¸€ä¸ªå¯å…¬å¼€è°ƒç”¨çš„ä½ç½®ã€‚
2. å‡½æ•°é—´é€šä¿¡é™åˆ¶ï¼šå†…åµŒå‡½æ•°æ— æ³•ç›´æ¥ä¸çˆ¶å‡½æ•°å¤–çš„ä»£ç è¿›è¡Œäº¤äº’ï¼Œå› ä¸ºå®ƒä»¬ä¸å¤–éƒ¨ä½œç”¨åŸŸéš”ç¦»ã€‚å¦‚æœéœ€è¦ä¸çˆ¶å‡½æ•°å¤–çš„ä»£ç è¿›è¡Œé€šä¿¡ï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨é—­åŒ…æˆ–å‚æ•°ä¼ é€’ç­‰æœºåˆ¶ã€‚

```rust
pub fn outer(data: u32) -> () {
    fn inner(data: u32) -> String {
        println!("inner");
        let res = data.to_string();
        println!("{}", &res);
        res
    }
    inner(data);
}


fn main() {
    outer(56_u32);
}
```

