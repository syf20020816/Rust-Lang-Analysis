# Technical Term

- author : syf20020816@outlook.com
- date : 2023-06-29

## æ—‹è½¬æ“ä½œ

æ—‹è½¬æ“ä½œï¼ˆrotation operationï¼‰æŒ‡çš„æ˜¯å¯¹äºŒè¿›åˆ¶æ•°è¿›è¡Œå¾ªç¯ä½ç§»çš„æ“ä½œã€‚æ—‹è½¬æ“ä½œåœ¨è®¡ç®—æœºç¼–ç¨‹ä¸­å¸¸å¸¸ç”¨äºä½æ“ä½œã€å¯†ç å­¦ã€æ•°æ®å‹ç¼©ç­‰é¢†åŸŸ

æ—‹è½¬æ“ä½œé€šå¸¸æ¶‰åŠä¸¤ä¸ªå‚æ•°ï¼šè¦æ—‹è½¬çš„äºŒè¿›åˆ¶æ•°å’Œæ—‹è½¬çš„ä½æ•°ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬å°† 10101100 å‘å·¦æ—‹è½¬ 2 ä½ï¼Œåˆ™ç»“æœåº”ä¸º 10110001ã€‚å‘å·¦æ—‹è½¬æ„å‘³ç€æœ€å·¦è¾¹çš„ä½å°†ç§»åŠ¨åˆ°æœ€å³è¾¹ï¼ŒåŒæ—¶ä¿æŒå…¶å®ƒä½çš„ç›¸å¯¹é¡ºåºä¸å˜ã€‚

åŒæ ·ï¼Œå¦‚æœæˆ‘ä»¬å°† 10101100 å‘å³æ—‹è½¬ 3 ä½ï¼Œåˆ™ç»“æœåº”ä¸º 10010101ã€‚å‘å³æ—‹è½¬æ„å‘³ç€æœ€å³è¾¹çš„ä½å°†ç§»åŠ¨åˆ°æœ€å·¦è¾¹ï¼ŒåŒæ—¶ä¿æŒå…¶å®ƒä½çš„ç›¸å¯¹é¡ºåºä¸å˜ã€‚

> note ï¼š å‘å·¦æ—‹è½¬å˜å¤§ï¼Œå‘å³æ—‹è½¬å˜å°

<img src="https://github.com/syf20020816/Rust-Lang-Analysis/blob/main/imgs/ro_example.png">

## äº¤æ¢æ“ä½œ

äº¤æ¢æ“ä½œï¼ˆswap operationï¼‰æŒ‡çš„æ˜¯å°†äºŒè¿›åˆ¶æ•°é«˜ä½ä¸ä½ä½è¿›è¡Œäº¤æ¢

ä¾‹å¦‚ï¼š1011 0101 äº¤æ¢å 0101 1011

## Const Trait

åœ¨Rustä¸­ï¼Œ`impl MyTrait`å’Œ`impl const MyTrait`ä¹‹é—´æœ‰ä¸€äº›åŒºåˆ«ã€‚

1. åŠŸèƒ½ç‰¹æ€§ï¼š`impl MyTrait`ç”¨äºå®ç°ä¸€ä¸ªæ™®é€šçš„traitï¼Œè¯¥traitå¯ä»¥åŒ…å«ä»»æ„çš„æ–¹æ³•å’Œå…³è”ç±»å‹ã€‚è€Œ`impl const MyTrait`ç”¨äºå®ç°ä¸€ä¸ªç‰¹æ®Šçš„traitï¼Œè¯¥traitåªèƒ½åŒ…å«å…·æœ‰`const`ä¿®é¥°ç¬¦çš„æ–¹æ³•ã€‚
2. æ–¹æ³•è°ƒç”¨ï¼šå¯¹äº`impl MyTrait`å®ç°çš„traitï¼Œå…¶æ–¹æ³•å¯ä»¥é€šè¿‡å®ä¾‹å¯¹è±¡è¿›è¡Œè°ƒç”¨ï¼Œå³å¯ä»¥ä½¿ç”¨åŠ¨æ€åˆ†å‘ã€‚è€Œ`impl const MyTrait`å®ç°çš„traitä¸­çš„æ–¹æ³•åªèƒ½é€šè¿‡ç±»å‹åç›´æ¥è°ƒç”¨ï¼Œå³ä½¿ç”¨é™æ€åˆ†å‘ã€‚
3. ç‰¹åŒ–å¸¸é‡ï¼š`impl MyTrait`å¯ä»¥åœ¨å®ç°ä¸­ä½¿ç”¨ç‰¹å®šçš„å¸¸é‡å€¼ã€‚å¯¹äº`impl const MyTrait`ï¼Œå®ƒå…è®¸åœ¨traitçš„æ–¹æ³•ä¸­ä½¿ç”¨constå¸¸é‡ï¼Œå¹¶ä¿è¯åœ¨ç¼–è¯‘æ—¶è¿›è¡Œè®¡ç®—ã€‚è¿™å¯ä»¥ç”¨äºåœ¨ç¼–è¯‘æœŸé—´ä¼˜åŒ–ä»£ç ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ`impl const`æ˜¯Rust 1.50ç‰ˆæœ¬å¼•å…¥çš„æ–°åŠŸèƒ½ï¼Œå› æ­¤å¦‚æœä½ ä½¿ç”¨è¾ƒæ—©çš„Rustç‰ˆæœ¬ï¼Œå¯èƒ½ä¸æ”¯æŒ`impl const`ã€‚

## å®å®ç°(å¸¸ç”¨å½¢å¼)

å…ˆçœ‹é—®é¢˜ï¼šä¸ºä»€ä¹ˆè¦å®ç°ä¸‰ç§
1. `impl<'a> const $imp<$u> for &'a $t `
2. `impl const $imp<&$u> for $t `
3. `impl const $imp<&$u> for &$t `

è¿™ä¸‰ç§å®å®ç°å½¢å¼çš„ç›®çš„æ˜¯ä¸ºäº†æä¾›æ›´çµæ´»çš„å®ä½¿ç”¨æ–¹å¼å’Œä»£ç å¤ç”¨ã€‚

1. `impl<'a> const $imp<$u> for &'a $t`ï¼šè¿™ç§å½¢å¼çš„å®å®ç°å…è®¸å°† trait å®ç°å…³è”åˆ°ä¸€ä¸ªå¼•ç”¨ç±»å‹ä¸Šï¼Œå¹¶ä¸”åœ¨ç¼–è¯‘æ—¶è¿›è¡Œå¸¸é‡è®¡ç®—ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹ä¸€ä¸ªå¼•ç”¨ç±»å‹å®ç°å¸¸é‡çº§çš„æ–¹æ³•ã€‚è¿™åœ¨æŸäº›æƒ…å†µä¸‹å¾ˆæœ‰ç”¨ï¼Œç‰¹åˆ«æ˜¯å½“æˆ‘ä»¬éœ€è¦å¯¹å¼•ç”¨è¿›è¡Œæ“ä½œä½†åˆä¸æƒ³å¤åˆ¶å®é™…æ•°æ®æ—¶ã€‚
2. `impl const $imp<&$u> for $t`ï¼šè¿™ç§å½¢å¼çš„å®å®ç°å…è®¸å°† trait å®ç°å…³è”åˆ°ä¸€ä¸ªå€¼ç±»å‹ä¸Šï¼Œå¹¶ä¸”åœ¨ç¼–è¯‘æ—¶è¿›è¡Œå¸¸é‡è®¡ç®—ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç¼–è¯‘æ—¶ä¸ºå€¼ç±»å‹å®ç°å¸¸é‡çº§çš„æ–¹æ³•ã€‚è¿™å¯¹äºéœ€è¦åœ¨ç¼–è¯‘æœŸæ‰§è¡ŒæŸäº›æ“ä½œçš„åœºæ™¯éå¸¸æœ‰ç”¨ï¼Œä¾‹å¦‚åœ¨ç¼–è¯‘æ—¶è®¡ç®—æŸäº›å€¼æˆ–æ‰§è¡ŒæŸäº›éªŒè¯ã€‚
3. `impl const $imp<&$u> for &$t`ï¼šè¿™ç§å½¢å¼çš„å®å®ç°å…è®¸å°† trait å®ç°å…³è”åˆ°ä¸€ä¸ªå¼•ç”¨ç±»å‹çš„å¼•ç”¨ä¸Šï¼Œå¹¶ä¸”åœ¨ç¼–è¯‘æ—¶è¿›è¡Œå¸¸é‡è®¡ç®—ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç¼–è¯‘æ—¶ä¸ºå¼•ç”¨ç±»å‹çš„å¼•ç”¨å®ç°å¸¸é‡çº§çš„æ–¹æ³•ã€‚è¿™åœ¨éœ€è¦åœ¨ç¼–è¯‘æ—¶æ“ä½œå¼•ç”¨çš„åœºæ™¯ä¸‹å¾ˆæœ‰ç”¨ï¼Œä¾‹å¦‚å¯¹å¤šå±‚å¼•ç”¨è¿›è¡Œæ“ä½œæ—¶ã€‚

è¿™ä¸‰ç§å®å®ç°å½¢å¼æä¾›äº†æ›´å¤šçš„çµæ´»æ€§å’Œä»£ç å¤ç”¨æ€§ï¼Œèƒ½å¤Ÿæ»¡è¶³ä¸åŒåœºæ™¯ä¸‹çš„éœ€æ±‚ï¼Œå¹¶ä¸”åœ¨ç¼–è¯‘æ—¶è¿›è¡Œå¸¸é‡è®¡ç®—å¯ä»¥æé«˜æ€§èƒ½å’Œä»£ç è´¨é‡ã€‚

## è¿›åˆ¶æ•°

è¿›åˆ¶æ•°æ˜¯ä¸€ç§è¡¨ç¤ºæ•°å­—çš„æ–¹å¼ï¼Œå®ƒå†³å®šäº†æ•°å­—ä¸­å„ä¸ªä½ç½®ä¸Šå¯ä»¥ä½¿ç”¨çš„ç¬¦å·å’Œå…¶å¯¹åº”çš„æƒé‡ã€‚å¸¸è§çš„è¿›åˆ¶åŒ…æ‹¬äºŒè¿›åˆ¶ï¼ˆbase 2ï¼‰ã€åè¿›åˆ¶ï¼ˆbase 10ï¼‰ã€å…«è¿›åˆ¶ï¼ˆbase 8ï¼‰å’Œåå…­è¿›åˆ¶ï¼ˆbase 16ï¼‰ã€‚è¿›åˆ¶æ•°ç”±åŸºæ•°ï¼ˆradixï¼‰ç¡®å®šï¼ŒåŸºæ•°è¡¨ç¤ºä¸€ä¸ªè¿›åˆ¶ç³»ç»Ÿä¸­å¯ç”¨çš„ä¸åŒç¬¦å·çš„æ•°é‡ã€‚

ä¾‹å¦‚ï¼Œåè¿›åˆ¶ä¸­çš„åŸºæ•°ä¸º 10ï¼Œå› æ­¤ä½¿ç”¨äº† 0 åˆ° 9 çš„åä¸ªæ•°å­—å­—ç¬¦æ¥è¡¨ç¤ºæ•°å­—ã€‚è€ŒäºŒè¿›åˆ¶ä¸­çš„åŸºæ•°ä¸º 2ï¼Œå› æ­¤åªèƒ½ä½¿ç”¨ 0 å’Œ 1 ä¸¤ä¸ªæ•°å­—å­—ç¬¦æ¥è¡¨ç¤ºæ•°å­—ã€‚ç±»ä¼¼åœ°ï¼Œå…«è¿›åˆ¶çš„åŸºæ•°ä¸º 8ï¼Œåå…­è¿›åˆ¶çš„åŸºæ•°ä¸º 16ã€‚

è¿›åˆ¶æ•°é€šè¿‡ä½¿ç”¨æƒé‡çš„æ–¹å¼æ¥è¡¨ç¤ºæ•°å­—ã€‚åœ¨åè¿›åˆ¶ä¸­ï¼Œæ¯ä¸ªæ•°å­—çš„æƒé‡æ˜¯ä»¥ 10 çš„å¹‚é€’å¢çš„ï¼Œæœ€å³è¾¹çš„æ•°å­—æƒé‡ä¸º 10^0ï¼Œå‘å·¦ä¾æ¬¡é€’å¢ã€‚ä¾‹å¦‚ï¼Œæ•°å­— 123 åœ¨åè¿›åˆ¶ä¸­è¡¨ç¤ºä¸º 1 * 10^2 + 2 * 10^1 + 3 * 10^0ã€‚è€Œåœ¨äºŒè¿›åˆ¶ä¸­ï¼Œæ¯ä¸ªæ•°å­—çš„æƒé‡æ˜¯ä»¥ 2 çš„å¹‚é€’å¢çš„ï¼Œæœ€å³è¾¹çš„æ•°å­—æƒé‡ä¸º 2^0ï¼Œå‘å·¦ä¾æ¬¡é€’å¢ã€‚

è¿›åˆ¶æ•°çš„é€‰æ‹©å–å†³äºæ‰€éœ€è¡¨ç¤ºçš„å€¼çš„ç‰¹å®šéœ€æ±‚ã€‚åè¿›åˆ¶æ˜¯æœ€å¸¸ç”¨çš„è¿›åˆ¶ï¼Œå› ä¸ºå®ƒç›´è§‚ä¸”æ˜“äºç†è§£ã€‚äºŒè¿›åˆ¶å¸¸ç”¨äºè®¡ç®—æœºç§‘å­¦å’Œæ•°å­—ç”µè·¯ä¸­ï¼Œå› ä¸ºè®¡ç®—æœºä½¿ç”¨çš„æ˜¯äºŒè¿›åˆ¶é€»è¾‘ã€‚å…«è¿›åˆ¶å’Œåå…­è¿›åˆ¶ç»å¸¸ç”¨äºè¡¨ç¤ºå†…å­˜åœ°å€ã€å­—èŠ‚åºåˆ—å’Œç¼–ç è¡¨ç¤ºç­‰ã€‚è¿›åˆ¶æ•°çš„èŒƒå›´é€šå¸¸é™åˆ¶åœ¨ 2 åˆ° 36ï¼Œè¿™æ˜¯å› ä¸ºè¯¥èŒƒå›´å†…æœ‰è¶³å¤Ÿçš„ç¬¦å·ï¼ˆæ•°å­—å’Œå­—æ¯ï¼‰å¯ä»¥è¡¨ç¤ºå„ä¸ªä½ä¸Šçš„å€¼ï¼Œè€Œä¸”æ¶µç›–äº†å¤§å¤šæ•°å¸¸è§çš„éœ€æ±‚ã€‚

## æ•°å­—æˆªæ–­

å‡ºè‡ªæºç `fn from_u32(u: u32) -> Self { u as Self }`çš„æ€è€ƒï¼ˆå°†u32è½¬ä¸ºå„ç§æ•´æ•°ç±»å‹æ¯”å¦‚u8ï¼Œä½†æ˜¯è‹¥è¾“å…¥çš„u32å¤§äºu8çš„æœ€å¤§å€¼æ˜¯å¦ä¼šå‡ºç°é”™è¯¯ï¼Ÿç­”æ¡ˆï¼šä¸ä¼šï¼Œå› ä¸ºé‡‡ç”¨äº†æ•°å­—æˆªæ–­ï¼‰

ä½¿ç”¨ `as` å…³é”®å­—å°†ä¸€ä¸ªæ•´æ•°ç±»å‹è½¬æ¢ä¸ºå¦å¤–ä¸€ä¸ªæ•´æ•°ç±»å‹æ—¶ï¼Œå¦‚æœç›®æ ‡ç±»å‹æ— æ³•è¡¨ç¤ºæºç±»å‹çš„å€¼èŒƒå›´ï¼Œä¼šå‘ç”Ÿæˆªæ–­è¡Œä¸ºã€‚å¯¹äºæ— ç¬¦å·æ•´æ•°ç±»å‹ï¼ˆæ¯”å¦‚ `u32` å’Œ `u8`ï¼‰ï¼Œæˆªæ–­è¡Œä¸ºæ„å‘³ç€è¶…å‡ºç›®æ ‡ç±»å‹èŒƒå›´çš„å€¼ä¼šè¢«æˆªæ–­ï¼Œåªä¿ç•™ä½ä½éƒ¨åˆ†ã€‚

å› æ­¤ï¼Œå¦‚æœå°†ä¸€ä¸ªå¤§äº `u8` æœ€å¤§å€¼çš„ `u32` å€¼è½¬æ¢ä¸º `u8` ç±»å‹ï¼Œæˆªæ–­è¡Œä¸ºä¼šè®©ç»“æœç­‰äºåŸå§‹å€¼å¯¹ `u8` å–æ¨¡çš„ç»“æœã€‚ä¾‹å¦‚ï¼Œå¦‚æœ `u` æ˜¯ä¸€ä¸ªå¤§äº `u8` æœ€å¤§å€¼çš„ `u32` å€¼ï¼Œé‚£ä¹ˆ `u as u8` çš„ç»“æœå°†æ˜¯ `u % 256`ã€‚

è¿™ç§æˆªæ–­è¡Œä¸ºå¹¶ä¸ä¼šå¼•å‘é”™è¯¯æˆ–äº§ç”Ÿç¼–è¯‘æ—¶é”™è¯¯ï¼Œè€Œæ˜¯ç”±ç¨‹åºå‘˜è´Ÿè´£ç¡®ä¿å®‰å…¨æ€§ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¯èƒ½éœ€è¦è¿›è¡Œæº¢å‡ºæ£€æŸ¥æˆ–å¤„ç†ã€‚

## match with judge

å‡ºè‡ªæºç ï¼š`core/src/num/mod.rs`ä¸­çš„`from_str_radix()`

match è¿›è¡ŒåŒ¹é…æ—¶åŠ åˆ¤æ–­ç›´æ¥è·Ÿåœ¨åé¢å†™å³å¯

```rust
fn main(){
    let src = "+";
    let index = 5;
    match src {
        "+" if index == 5 => {
            println!("first 5")
        }
        _ => {}
    }
}
```

## ä½ç§»ç›¸æ¯”æ•°å­—è®¡ç®—çš„ä¼˜ç‚¹

å·¦ç§»å’Œå³ç§»æ˜¯ä½è¿ç®—ä¸­å¸¸è§çš„æ“ä½œï¼Œä¸»è¦ç”¨äºå¯¹äºŒè¿›åˆ¶æ•°è¿›è¡Œç§»ä½æ“ä½œã€‚ä¸æ•°å€¼è¿ç®—ç›¸æ¯”ï¼Œå·¦ç§»å’Œå³ç§»å…·æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š

1. æ•ˆç‡æ›´é«˜ï¼šä½ç§»æ“ä½œé€šå¸¸æ¯”æ•°å€¼è¿ç®—æ›´å¿«ï¼Œå› ä¸ºå®ƒä»¬æ˜¯åº•å±‚çš„ä½çº§æ“ä½œï¼Œç›´æ¥å¯¹äºŒè¿›åˆ¶æ•°æ®è¿›è¡Œæ“ä½œï¼Œä¸æ¶‰åŠä¹˜æ³•ã€é™¤æ³•ç­‰å¤æ‚çš„æ•°å­¦è¿ç®—ã€‚
2. ç»“æœå¯é¢„æµ‹ï¼šä½ç§»æ“ä½œçš„ç»“æœæ˜¯ç¡®å®šçš„ä¸”å¯é¢„æµ‹çš„ï¼Œä¸å—æœºå™¨å­—é•¿çš„å½±å“ã€‚æ— è®ºæ˜¯åœ¨32ä½ç³»ç»Ÿè¿˜æ˜¯64ä½ç³»ç»Ÿä¸Šæ‰§è¡Œä½ç§»ï¼Œç»“æœéƒ½ä¸€è‡´ã€‚
3. é€»è¾‘æ¸…æ™°ï¼šåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä½¿ç”¨ä½ç§»æ“ä½œå¯ä»¥ä½¿ä»£ç æ›´åŠ ç›´è§‚å’Œæ˜“äºç†è§£ã€‚æ¯”å¦‚ï¼Œå°†ä¸€ä¸ªæ•´æ•°å·¦ç§» n ä½ï¼Œç›¸å½“äºå°†è¯¥æ•´æ•°ä¹˜ä»¥ 2 çš„ n æ¬¡æ–¹ï¼›å°†ä¸€ä¸ªæ•´æ•°å³ç§» n ä½ï¼Œç›¸å½“äºå°†è¯¥æ•´æ•°é™¤ä»¥ 2 çš„ n æ¬¡æ–¹å¹¶å‘ä¸‹å–æ•´ã€‚
4. ä½æ©ç æ“ä½œï¼šä½ç§»æ“ä½œç»å¸¸ä¸ä½æ©ç æ“ä½œç»“åˆä½¿ç”¨ï¼Œç”¨äºæå–æˆ–è®¾ç½®ç‰¹å®šçš„ä½ã€‚é€šè¿‡å·¦ç§»å’Œå³ç§»é…åˆä½¿ç”¨ï¼Œå¯ä»¥è½»æ¾åœ°å®ç°å¯¹æŒ‡å®šä½çš„è¯»å–ã€ä¿®æ”¹æˆ–å†™å…¥ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå·¦ç§»å’Œå³ç§»æ˜¯ä½çº§æ“ä½œï¼Œå…¶ç»“æœä¹Ÿæ˜¯æŒ‰ä½è®¡ç®—çš„ã€‚åœ¨è¿›è¡Œä½ç§»æ“ä½œæ—¶ï¼Œéœ€è¦æ˜ç¡®è€ƒè™‘æ•°æ®ç±»å‹å’Œç§»åŠ¨çš„ä½æ•°ï¼Œä»¥é¿å…æº¢å‡ºæˆ–é€»è¾‘é”™è¯¯ã€‚

## ^è¿ç®—å’Œ&è¿ç®—

- ^ : å¼‚ 1 åŒ 0 ï¼ˆ1^1 = 0 , 0^0 = 0 , 1^0 = 1ï¼‰
- & : 1 1 other 0 (1&1=1 , 1&0=0 , 0&0=0)

## æ— åˆ†æ”¯ç®—æ³•(branchless algorithm)

`(a + b) / 2` == `((a ^ b) >> 1) + (a & b)`.

ä¾‹å¦‚ï¼š

```
a = 5
b = 7
(a+b)/2 = 6
a^b == 101^111 = 010
010 >> 1 = 01
a&b == 101&111 = 101
01 + 101 = 110 == 2+4 = 6
```

## ğŸ¦€ç¼–è¯‘å™¨å†…éƒ¨å‡½æ•°è¯´æ˜

ç¼–è¯‘å™¨å†…éƒ¨å‡½æ•°ã€‚ç›¸åº”çš„å®šä¹‰åœ¨https://github.comrust-langrustblobmastercompilerrustc_codegen_llvmsrcintrinic.rsä¸­ã€‚ç›¸åº”çš„constå®ç°åœ¨https://github.comrust-angrustbloBMastercompile rrustc_const_evalsrcinterprisetriniscs.rsä¸­ã€‚

æºç ä½ç½®ï¼š`core::intrinsics`

```rust
    /// Returns the number of bits set in an integer type `T`
    ///
    /// Note that, unlike most intrinsics, this is safe to call;
    /// it does not require an `unsafe` block.
    /// Therefore, implementations must not require the user to uphold
    /// any safety invariants.
    ///
    /// The stabilized versions of this intrinsic are available on the integer
    /// primitives via the `count_ones` method. For example,
    /// [`u32::count_ones`]
    #[rustc_const_stable(feature = "const_ctpop", since = "1.40.0")]
    #[rustc_safe_intrinsic]
    #[rustc_nounwind]
    pub fn ctpop<T: Copy>(x: T) -> T;
```

## ğŸ¦€Rust éç»‘å®šæ¨¡å¼(non-binding)

åœ¨ Rust çš„ match è¡¨è¾¾å¼ä¸­ï¼Œæ¯ä¸ªæ¨¡å¼åŒ¹é…çš„åˆ†æ”¯éƒ½ä¼šå¯¹å˜é‡è¿›è¡Œæ¨¡å¼è§£æ„ï¼Œå¹¶æ ¹æ®éœ€è¦ç§»åŠ¨ã€å€Ÿç”¨æˆ–å¤åˆ¶å˜é‡ã€‚

ç„¶è€Œï¼Œåœ¨ Rust 1.26 ç‰ˆæœ¬ä¹‹åï¼ŒRust å¼•å…¥äº†éç»‘å®šï¼ˆnon-bindingï¼‰çš„æ¨¡å¼ï¼Œå…è®¸åœ¨ match è¡¨è¾¾å¼ä¸­ä½¿ç”¨æœªç»‘å®šçš„å˜é‡ã€‚è¿™äº›æœªç»‘å®šçš„å˜é‡åœ¨æ¨¡å¼åŒ¹é…è¿‡ç¨‹ä¸­ä¸ä¼šå¼•èµ·ä»»ä½•ç§»åŠ¨ã€å€Ÿç”¨æˆ–å¤åˆ¶æ“ä½œã€‚

åœ¨å¦‚ä¸‹ä»£ç ç¤ºä¾‹ä¸­:

```rust
#[derive(Debug)]
pub enum FpCategory {
    Nan,
    Infinite,
    Zero,
    Subnormal,
    Normal,
}

const fn classify_bits(b: u32) -> FpCategory {
    //0111 1111 1000 0000 0000 0000 0000 0000
    const EXP_MASK: u32 = 0x7f800000;
    //0111 1111 1111 1111 1111 1111
    const MAN_MASK: u32 = 0x007fffff;
    //è¿™é‡Œçš„matchç¼–è¾‘å™¨ä¼šæç¤ºä½ :Use of moved value 
    //ä½†å®é™…ä¸Šå¹¶æ²¡æœ‰é”™è¯¯
    match (b & MAN_MASK, b & EXP_MASK) {
        (0, EXP_MASK) => FpCategory::Infinite,
        (_, EXP_MASK) => FpCategory::Nan,
        (0, 0) => FpCategory::Zero,
        (_, 0) => FpCategory::Subnormal,
        _ => FpCategory::Normal,
    }
}


fn main() {
    let a: u32 = 0x1ff;
    let res = classify_bits(a);
    dbg!(res);
}
```

è¿™é‡Œ`(b & MAN_MASK, b & EXP_MASK)`æ˜¯ä¸€ä¸ªéç»‘å®šçš„æ¨¡å¼ï¼Œå…¶ä¸­çš„ b å¹¶ä¸ä¼šè¢«ç§»åŠ¨ï¼Œå› ä¸ºå®ƒæ²¡æœ‰è¢«ä½¿ç”¨ã€‚

## ğŸ¦€å†…åµŒå‡½æ•°ï¼ˆNested Functionï¼‰

è¿™é‡Œæˆ‘ä»¬è¦å­¦ä¹ çš„æ˜¯ä¸€ç§å†…åµŒå‡½æ•°çš„å†™æ³•

ä¼˜ç‚¹ï¼š

1. å°è£…æ€§å’Œç§æœ‰æ€§ï¼šå†…åµŒå‡½æ•°åªåœ¨å…¶çˆ¶å‡½æ•°å†…éƒ¨å¯è§ï¼Œè€Œå¯¹äºå¤–éƒ¨ä»£ç æ¥è¯´æ˜¯éšè—çš„ã€‚è¿™å¯ä»¥å¢å¼ºä»£ç çš„å°è£…æ€§å’Œæ¨¡å—åŒ–ï¼Œä½¿å¾—å†…éƒ¨é€»è¾‘å¯¹å¤–éƒ¨ä»£ç æ˜¯ä¸å¯è§çš„ï¼Œæé«˜äº†ä»£ç çš„å®‰å…¨æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚
2. ä»£ç å¤ç”¨ï¼šé€šè¿‡å°†åŠŸèƒ½ç›¸ä¼¼çš„ä»£ç åŒ…è£…åœ¨å†…éƒ¨å‡½æ•°ä¸­ï¼Œå¯ä»¥é¿å…ä»£ç é‡å¤ã€‚å†…åµŒå‡½æ•°å¯ä»¥è¢«çˆ¶å‡½æ•°å¤šæ¬¡è°ƒç”¨ï¼Œæä¾›äº†ä¸€ç§ä»£ç å¤ç”¨çš„æœºåˆ¶ã€‚
3. é€»è¾‘æ¸…æ™°æ€§ï¼šå†…åµŒå‡½æ•°å¯ä»¥å°†å¤æ‚çš„é€»è¾‘åˆ†è§£æˆæ›´å°çš„ã€æ›´æ˜“ç†è§£çš„éƒ¨åˆ†ã€‚é€šè¿‡å°†ä»£ç åˆ†å‰²æˆé€»è¾‘ç›¸å…³çš„å—ï¼Œå¯ä»¥æé«˜ä»£ç çš„å¯è¯»æ€§å’Œå¯ç†è§£æ€§ã€‚

ç¼ºç‚¹ï¼š

1. å¯è§èŒƒå›´é™åˆ¶ï¼šå†…åµŒå‡½æ•°åªèƒ½åœ¨å…¶çˆ¶å‡½æ•°å†…éƒ¨è°ƒç”¨ï¼Œæ— æ³•åœ¨å…¶å®ƒå‡½æ•°æˆ–æ¨¡å—ä¸­ä½¿ç”¨ã€‚å¦‚æœéœ€è¦åœ¨å…¶å®ƒåœ°æ–¹å¤ç”¨è¯¥åŠŸèƒ½ï¼Œå°±éœ€è¦å°†å†…åµŒå‡½æ•°æå–åˆ°ä¸€ä¸ªå¯å…¬å¼€è°ƒç”¨çš„ä½ç½®ã€‚
2. å‡½æ•°é—´é€šä¿¡é™åˆ¶ï¼šå†…åµŒå‡½æ•°æ— æ³•ç›´æ¥ä¸çˆ¶å‡½æ•°å¤–çš„ä»£ç è¿›è¡Œäº¤äº’ï¼Œå› ä¸ºå®ƒä»¬ä¸å¤–éƒ¨ä½œç”¨åŸŸéš”ç¦»ã€‚å¦‚æœéœ€è¦ä¸çˆ¶å‡½æ•°å¤–çš„ä»£ç è¿›è¡Œé€šä¿¡ï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨é—­åŒ…æˆ–å‚æ•°ä¼ é€’ç­‰æœºåˆ¶ã€‚

```rust
pub fn outer(data: u32) -> () {
    fn inner(data: u32) -> String {
        println!("inner");
        let res = data.to_string();
        println!("{}", &res);
        res
    }
    inner(data);
}


fn main() {
    outer(56_u32);
}
```

## ğŸ¦€Rustç¼–è¯‘å™¨æ¨æ–­æ‰§è¡Œå‡½æ•°

è¿™é‡Œè¦ä»‹ç»ä¸€ä¸ªå†…éƒ¨å‡½æ•°ï¼šç¼–è¯‘å™¨æ¨æ–­æ‰§è¡Œå‡½æ•°`intrinsics::const_eval_select()`

``` rust
core::intrinsics
pub extern "rust-intrinsic" fn const_eval_select<ARG: Tuple, F, G, RET>(arg: ARG, called_in_const: F, called_at_rt: G) -> RET where G: FnOnce<ARG, Output = RET>,F: FnOnce<ARG, Output = RET>,
```
### ä½œç”¨

æ ¹æ®ä¸Šä¸‹æ–‡é€‰æ‹©è¦è°ƒç”¨çš„å‡½æ•°ã€‚ å¦‚æœåœ¨ç¼–è¯‘æ—¶å¯¹è¯¥å‡½æ•°æ±‚å€¼ï¼Œåˆ™å¯¹è¯¥å†…åœ¨å‡½æ•°çš„è°ƒç”¨å°†è¢«å¯¹called_in_constçš„è°ƒç”¨æ‰€å–ä»£ã€‚å¦åˆ™ï¼Œå®ƒå°†è¢«ä¸€ä¸ªå¯¹called_at_rtçš„è°ƒç”¨æ‰€å–ä»£ã€‚ ç±»å‹è¦æ±‚ è¿™ä¸¤ä¸ªå‡½æ•°å¿…é¡»éƒ½æ˜¯å‡½æ•°é¡¹ã€‚å®ƒä»¬ä¸èƒ½æ˜¯å‡½æ•°æŒ‡é’ˆæˆ–é—­åŒ…ã€‚ç¬¬ä¸€ä¸ªå‡½æ•°å¿…é¡»æ˜¯å¸¸é‡fnã€‚ argå°†æ˜¯ä¼ é€’ç»™ä¸¤ä¸ªå‡½æ•°ä¸­ä»»æ„ä¸€ä¸ªçš„å…ƒç»„å‚æ•°ï¼Œå› æ­¤ï¼Œä¸¤ä¸ªå‡½æ•°å¿…é¡»æ¥å—ç›¸åŒç±»å‹çš„å‚æ•°ã€‚ä¸¤ä¸ªå‡½æ•°éƒ½å¿…é¡»è¿”å›RETã€‚

### å¼•å…¥

ç”±äºè¿™ä¸ªæ¨æ–­å‡½æ•°æ˜¯rustçš„unstableçš„æ‰€ä»¥ä½ éœ€è¦åœ¨å…¶ä¸­ä½¿ç”¨å¦‚ä¸‹ç‰¹æ€§å®

```rust
//! unstable æ ¸å¿ƒå†…éƒ¨å‡½æ•°ä½¿ç”¨ç‰¹æ€§
#![feature(core_intrinsics)]
#![feature(const_eval_select)]
```

### ä¸ºä»€ä¹ˆè¦ç”¨?

ä»–çš„ä¸»è¦ä½¿ç”¨åŸå› æ˜¯ä¸ºäº†åœ¨ä¸åŒçš„ç¼–è¯‘ç¯å¢ƒå’Œç¼–è¯‘å™¨ä¼˜åŒ–çš„æƒ…å†µä¸‹æä¾›æ›´å¥½çš„å…¼å®¹æ€§å’Œæ€§èƒ½ã€‚ä½†æ˜¯è¿™å¼•å…¥äº†ä¸€ä¸ªunsafeçš„æ“ä½œ,æ‰€ä»¥å¼€å‘è€…éœ€è¦ä¿è¯åœ¨ä½¿ç”¨è¿™äº›åŠŸèƒ½å‰åçš„ä¸Šä¸‹æ–‡ä¸­ï¼Œä»£ç çš„è¡Œä¸ºæ˜¯å®‰å…¨çš„ï¼Œå¹¶ä¸”ç¬¦åˆ Rust çš„å†…å­˜å®‰å…¨è§„åˆ™ã€‚è‹¥ä½ æ— æ³•åšåˆ°ä¼˜ç§€çš„æ§åˆ¶ï¼Œæˆ‘ä»¬æ›´åº”è¯¥åˆ†ç¦»å®ç°ï¼Œä¸å»ä½¿ç”¨ç¼–è¯‘å™¨æ¨æ–­æ‰§è¡Œå‡½æ•°ã€‚

```rust
unsafe{
    intrinsics::const_eval_select((data,), const_fn, dyn_fn)
}
```

## ğŸ¦€impl [] and impl () è‡ªå®šä¹‰å¤åˆç±»å‹å®ç°

Rust ä¸å…è®¸ä¸ºåŸç”Ÿç±»å‹ï¼ˆprimitive typesï¼‰å®ç°ç›´æ¥çš„ inherent implã€‚åŸç”Ÿç±»å‹åŒ…æ‹¬åƒ u8ã€char è¿™æ ·çš„åŸºæœ¬ç±»å‹ã€‚ Rust æä¾›äº†æ‰©å±•ç‰¹æ€§ï¼ˆextension traitï¼‰çš„æœºåˆ¶ã€‚ä¸ºåŸç”Ÿç±»å‹åˆ›å»ºä¸€ä¸ª traitï¼Œç„¶ååœ¨è¯¥ trait ä¸Šå®ç°æ–¹æ³•ã€‚æ— è®ºæ˜¯å…ƒç»„è¿˜æ˜¯æ•°ç»„éƒ½æ”¯æŒè¿™ç§å†™æ³•ã€‚

### impl []

```rust
pub trait AsciiCharSlice<Rhs = AsciiChar> {
    type Origin;
    fn as_str(&self) -> Vec<&str>;
}

impl AsciiCharSlice for [AsciiChar] {
    type Origin = AsciiChar;

    fn as_str(&self) -> Vec<&str> {
        let mut res:Vec<&str> = Vec::new();
        for item in self {
            match item {
                AsciiChar::Null => res.push("Null"),
                AsciiChar::Delete => res.push("Delete"),
                _ => ()
            }
        }
        res
    }
}
```

### impl ()

```rust
trait TupleTrait{
    fn do_change()->();
}

impl TupleTrait for (f32,f32,f32){
    fn do_change() -> () {
        println!("{}","do change");
    }
}

fn main() {
    let a:(f32, f32, f32) = (1.0_f32, 1.2_f32, 25.6_f32);
    let _ = <(f32, f32, f32)>::do_change();
}
```

## ğŸ¦€`?Sized`éå›ºå®šå¤§å°æ•°æ®

å…³é”®å­— `?Sized` ç”¨äºè¡¨ç¤ºä¸€ä¸ªç±»å‹å¯èƒ½æ˜¯ä¸å®šå¤§å°ï¼ˆunsizedï¼‰çš„ç±»å‹ã€‚ä¸å®šå¤§å°ç±»å‹æ˜¯æŒ‡åœ¨ç¼–è¯‘æ—¶æ— æ³•ç¡®å®šå…·ä½“å¤§å°çš„ç±»å‹ï¼Œä¾‹å¦‚åŠ¨æ€åˆ†é…çš„æ•°ç»„æˆ– trait å¯¹è±¡ã€‚

å¸¸ç”¨äºæ–¹æ³•çš„æ³›å‹çº¦æŸä¸Šï¼Œ`T: ?Sized` è¡¨ç¤ºæ³›å‹ç±»å‹ `T` å¯èƒ½æ˜¯ä¸å®šå¤§å°çš„ç±»å‹ã€‚è¿™æ„å‘³ç€å‡½æ•°å¯ä»¥æ¥å—ä»»æ„å¤§å°çš„ `T` ç±»å‹ä½œä¸ºå‚æ•°ï¼ŒåŒ…æ‹¬ä¸å®šå¤§å°çš„ç±»å‹ã€‚

ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ `?Sized` å‰ç¼€å‘¢ï¼Ÿè¿™æ˜¯å› ä¸º Rust é»˜è®¤æƒ…å†µä¸‹è¦æ±‚æ³›å‹ç±»å‹æ˜¯å¤§å°å·²çŸ¥çš„ï¼ˆsizedï¼‰ï¼Œè¿™æ ·æ‰èƒ½åœ¨æ ˆä¸Šåˆ†é…å†…å­˜ã€‚ä½†æ˜¯æœ‰äº›ç±»å‹çš„å¤§å°æ˜¯åœ¨è¿è¡Œæ—¶æ‰èƒ½ç¡®å®šçš„ï¼Œä¾‹å¦‚å…·æœ‰åŠ¨æ€æ•°ç»„é•¿åº¦çš„æ•°ç»„ç±»å‹ï¼Œæˆ–è€… trait å¯¹è±¡ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ç±»å‹å‰é¢åŠ ä¸Š `?Sized` æ¥è¡¨æ˜å®ƒæ˜¯ä¸å®šå¤§å°çš„ï¼Œä»è€Œå…è®¸å®ƒä»¬ä½œä¸ºæ³›å‹å‚æ•°ã€‚
